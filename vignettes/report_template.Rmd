---
title: "FishSET report template"
author: "Enter name here"
date: "`r Sys.Date()`"
output: html_document
params:
  project: "Enter project name here"
  date: !r Sys.Date()
  printcode: false
---

## Before you start: 

### Using the FishSET template

This is the FishSET package template written in [R Markdown](http://rmarkdown.rstudio.com), it is designed to assist in writing and presenting output in a reproducible manner. The template is divided into several sections, each with a series of guiding questions and suggestions. At any point you can add or delete text as needed.

The template is designed to be used in two steps. First, to run interactive code and save output. Second, to load output and fill in text before generating (or "knitting") the document.

Guiding comments are provided between "<!-" and " -->". These comments will not show up in the output document.
Guidance in R code is commented out with "#".

### Generating notebook reports 

This section provides some basic tips for creating reports with R Markdown. Markdown documents are composed of text and code chunks. Text can be formatted by using special characters. For more information on text formatting, see https://bookdown.org/yihui/rmarkdown/markdown-syntax.html. 

Code chunks allow you to run and display code output. To create a chunk, you can click the "Insert" drop down menu in right-hand corner of the document window and select "R". Or you can use the keyboard shortcut "Ctrl + Alt + I" for Windows and "Command + Option + I" for Mac. Here's an example of a R code chunk:

```{r}
2 + 2
```

To run the code, click on the green arrow in the far right-hand corner of the chunk. The output will be shown directly beneath the chunk. Code output can also be incorporated into the body of text by using this format: `r 2 + 2`. Code chunks can be run as many times as necessary, and can easily be adjusted or updated until the desired output is achieved. This feature is very useful before rendering the report into a static document.

To generate your report, click on the "Knit" icon located on the toolbar. By default the report is knitted to an html page, however other output options, such as Microsoft Word and PDF, are available as well.


### Overview of the report functions

The FishSET template contains a suite of report functions designed to allow users to view and insert output created while using FishSET. These functions fall into one of three categories:

* Output functions
* Model summary functions
* Log summary functions

The output functions retrieve plots, tables, and notes from the package's output folder. FishSET automatically saves output generated by its functions and are located the package's output folder. Rather than finding the output folder on your own, FishSET provides a series of functions that **pull** from this folder automatically, allowing you to place the relevant plot or table within a code chunk. 

* `pull_output` is the primary output function--it can retrieve plots, tables, and notes given a project name, date, function name, and output type.
  + Ex: pull_output("pollock", "density_plot", date = "2020-08-11", type = "plot")
* `pull_plot`, `pull_table`, and `pull_notes` are the same as `pull_output` but each retrieves a specific output type.
  + Ex: pull_plot("pollock", "density_plot", date = "2020-08-11")

In the above examples, both outputs are the same: the plot for the function density_plot generated on 2020-08-11 for project "pollock" is retrieved and displayed.

Since only one version of a function's output can be saved each day for each project, you may want to save output to a personal folder. If you would like to **insert** this output into the template use:

* `insert_plot`
* `insert_table`

Both of these function require that an object named "locuser" containing a valid folder directory exists in the global environment (for more information on finding a folder directory, see [insert helpful link here]). Enter the name of the file located in your folder and it will be displayed in the report. 

The Model summary functions display model output saved to the FishSET database. `model_out_summary`, `model_error_summary`, and `model_fit_summary` show model output, error, and fit tables given a project name. 

Every function call is saved to the FishSET log folder. To view the log content for a project, use the `function_summary` log function. This function will display each time a function was run and what its arguments were. Often, you may run a function several times but only keep the output from a single iteration. To select the log calls that are relevant to your current analysis, use `filter_summary`.  

In many cases the report functions will already be placed in the template and only require you to update certain arguments. 

### Using interactive functions


### Report setup


```{r, setup, include=FALSE}
# The setup code chunk should be the first chunk in your report
knitr::opts_chunk$set(echo = FALSE)
library(pander)
library(FishSET)
```

#### Report parameterization

Once your report is finish and ready to be rendered into a static document, you may want to fully parameterize your report so that it can be used as a template for future reports. To do this, enter your list of parameters in the YAML section of the report (the very top portion) under the section labeled "params:". Fill in the project and date parameters and declare any others you may want to include in your report. Then, use the `params` object to access the values listed in the parameter section as shown below:

```{r}
params$project
params$date
```


## Introduction

* What are your main questions? 
 
* Who do you want to study?

* What aspects do you want to understand?
 
* Why are you conducting this analysis?

## Data verification

* What data are needed? 

* Which variables do you need to explore your questions? 

* Which model(s) do you plan to use? 
  + Models have differing data requirements. See "model design file" in the FishSET user manual to review the available models and their requirements. 

## Upload Data

Describe the data you will need for your analysis, for example its source (Fish ticket, Observer etc.), time frame, and size (number of observations and variables). 

* Main data
* Port
* Grid
* Spatial
* Auxiliary

### Upload notes

```{r}
parse_notes(project = params$project, date = params$date, section = "upload")
```


### Summary of dataset 


```{r dat-summary, fig.height=4, fig.width=4}

summary_table(params$project)
```





### Outliers

* Which variables contained outliers, how many, and how were they treated? 
  + `outlier_table` and `outlier_plot` allow you to see outliers by variable.
  + `outlier_remove` removes outliers with several subsetting options. 


### Missing values

* Which variables contained NAs and/or NaNs, how many, and how were they treated?
 + Missing values can affect model output.
 + To identify NAs and NaNs use `nan_identify`.
 + To remove or replace NAs and NaNs, use `nan_filter` and `na_filter`. 

### Unique observations

* Are all observations unique (no duplicate rows)? 
  + Each row should represent a unique event.
  + Use `unique_filter` to remove duplicate rows. 

### Empty variables

* Are any variables empty?
  + Removing empty variables makes your dataset tidier and analyses faster.
  + Use `empty_vars_filter` to find and remove empty variables.


### Latitude and longitude units

* Were lat and lon columns in the correct format (decimal degrees)?
  + `degree` can check and correct lat and lon variables. 


## Data exploration

* Were any non-empty variables removed or altered?
  + Some variables may not be necessary for analysis and can be removed for efficiency.
  + `select_vars_gui` is an interactive function that allows you to select which variables to include in your analysis
  + Use `add_vars` or `add_vars_gui` to add previously removed variables.
  
* Were any changes made to a variable's class?
  + `changeclass` can show and change variable class. 

* Was the dataset subsetted? 
  + Datasets can be filtered using `filter_dat`.
  + a table of filters can be retrieved from the FishSET database using `table_view`. Filter tables are saved using the naming convention "projectFilterTable". 





## Fleet analysis and assignment

### Fleet notes
```{r}
parse_notes(project = params$project, date = params$date, section = "fleet")
```

### Fleet Assignment

* How were fleets defined? 


#### Fleet Table
```{r fleet-table}
view_fleet_table(params$project)
```



### Summary functions 

(example)
```{r density-plot}
pull_plot(params$project, "density_plot", date = params$date)
```


(example)
```{r vessel-count}
pull_table(params$project, "vessel_count", date = params$date)
```


## Create new variables

* What variables did you create for your analysis?
  + FishSET provides several functions for creating variables, for a complete list please see the **FishSET User Manual** or the **FishSET Function List**. 
  + Numeric:
  + Temporal:
  + Categorical:
  


## Zonal Definition

* How were observations assigned to zones?

## Expected Catch/Revenue



## Models 

### Create model design file


### Model Summary
```{r model-summary}
pander(
  FishSET:::model_out_summary(params$project)
)
```

### Model Error
```{r model-error}
pander(
  FishSET:::model_error_summary(params$project)
   )
```

### Model Fit
```{r model-fit}
pander(
    FishSET:::model_fit_summary(params$project)
  )
```




## Appendix: Notes

```{r}
pander(
  pandoc.list(
  FishSET::pull_notes(params$project, date = params$date)
)
)
```

## Appendix: Log Calls

### Data Loading
```{r dat-load}
pander(
#  pandoc.table(
FishSET:::function_summary(date = params$date, type = "dat_load", show = "last")#,
  # justify = "left", style = "simple", row.names = FALSE
  # )
)
```

### Data Quality Evaluation
```{r dat-qual}
 pander(
#   pandoc.table(
function_summary(date = params$date, type = "dat_quality", show = "last")#,
#  justify = "left", style = "simple", row.names = FALSE
#   )
 )
```

### Data Exploration
```{r dat_explore}
pander(
 # pandoc.table(
  function_summary(date = params$date, type = "dat_exploration", show = "last"),
  # justify = "left", style = "simple", row.names = FALSE
  # )
)
```


### Fleet Analysis and Assignment
```{r fleet}
pander(
 # pandoc.table(
    FishSET:::function_summary(date = params$date, type = "fleet", show = "last"),
  # justify = "left", style = "simple", row.names = FALSE
  # )
)
```

### Zonal Definition
```{r zonal-def}
pander(
#  pandoc.table(
    FishSET:::function_summary(date = params$date, type = "zonal_def", show = "last"),
  # justify = "left", style = "simple", row.names = FALSE
  # )
)
```

### Models
```{r model-fun}
pander(
#  pandoc.table(
    FishSET:::function_summary(date = params$date, type = "model", show = "last"),
  # justify = "left", style = "simple", row.names = FALSE
  # )
)
```



