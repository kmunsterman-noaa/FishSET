<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>FishSET R package functions</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">FishSET R package functions</h1>



<!--  pdf_document: default -->
<!--  html_notebook: default-->
<!--  word_document: default-->
<!--  html_document:-->
<!--    df_print: paged-->
<div id="getting-started" class="section level2">
<h2>Getting started</h2>
<p>The FishSET R package includes functions that can be used in the R console or that can be run through the FishSET app (a guided user interface built u sing the Shiny R package). Calling function through the R console allows for greater flexibility and ease in troubleshooting but requires knowledge of R and the FishSET R package. The FishSET app is meant to allow for users to use functions and models with limited knowledge of R. The FishSET app is opened by typing <code>run_fishset()</code> in the R console. This tutorial does not use the FishSET app but walks through examples of FishSET R package functions in the R console.</p>
</div>
<div id="load-the-package." class="section level2">
<h2>Load the package.</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">'devtools'</span>)
<span class="kw">library</span>(devtools)
<span class="kw">install.packages</span>(<span class="st">&quot;PATH/TO/Directory/Containing/FishSET&quot;</span>, <span class="dt">repos=</span><span class="ot">NULL</span>, <span class="dt">type=</span><span class="st">'source'</span>)
<span class="kw">library</span>(FishSET)</code></pre></div>
</div>
<div id="upload-data" class="section level2">
<h2>Upload data</h2>
<p>When the data is loaded into the FishSET database a series of checks are performed. The output of these checks will be printed to the R console. Check these messages to identify if any corrections should be made. In the box below, we load both the main data set and the port data. We will also need a spatial data set. We will load that with the <code>read_dat</code> function. The <code>read_dat</code> function recognizes most data formats, including spss, json, and stata, and reads the data into the working environment. The functions does not save the data into the FishSET database.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Upload data</span>
<span class="kw">load_maindata</span>(dat, <span class="dt">over_write =</span> <span class="ot">TRUE</span>, <span class="dt">project =</span> <span class="st">'EXAMP'</span>) 
<span class="kw">load_port</span>(dat, <span class="dt">port_name =</span> port, <span class="dt">over_write =</span> <span class="ot">TRUE</span>, <span class="dt">project =</span> <span class="st">'EXAMP'</span>)
spatdat &lt;-<span class="st"> </span><span class="kw">read_dat</span>(<span class="st">''</span>)</code></pre></div>
<p>Data are now loaded into the FishSET database. The first line of code below returns a list of all the data tables in the FishSET database. The second line of code returns the first six lines of data from the data table you just loaded into the database.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tables_database</span>()
<span class="kw">head</span>(<span class="kw">table_view</span>(<span class="st">'projectMainDataTable'</span>))</code></pre></div>
<p>Additional codes for working within the FishSET database:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Check whether a table exists in the database.</span>
  <span class="kw">table_exists</span>()      
<span class="co">#Remove a table from the database.</span>
 <span class="kw">table_remove</span>()     
<span class="kw">table_fields</span>()      View column names of data table.</code></pre></div>
</div>
<div id="data-quality" class="section level2">
<h2>Data Quality</h2>
<p>FishSET has built-in functions to check for NAs, NaNs, outliers, unique observations, empty variables, and whether latitude and longitude variables are in the correct format. The <code>data_verification</code> function checks for these potential issues. All messages returned to R console are also saved in the log file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">data_verification</span>()
  <span class="co"># The following functions are contained in `data_verification` but can be run on their own too.</span>
    <span class="kw">outlier_check</span>()
    <span class="kw">nan_identify</span>()</code></pre></div>
<p>Functions also exist to view table or plot output of data quality assessments. All plots and tables are automatically saved with project name to the <code>output</code> folder in the FishSET R package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Table output functions</span>
  <span class="kw">summary_stats</span>()
  <span class="kw">outlier_table</span>() 
  
<span class="co">#Plots output functions</span>
  <span class="kw">outlier_plot</span>()</code></pre></div>
<p>Functions to correct data quality issues.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">na_filter</span>()
  <span class="kw">nan_filter</span>()

  <span class="kw">outlier_remove</span>()

  <span class="kw">unique_filter</span>()

  <span class="kw">empty_vars_filter</span>()

  <span class="kw">degree</span>()</code></pre></div>
<p>Data tables can be filtered using the <code>filter_table</code> and <code>filter_dat</code> functions. The filter statements are saved as a table in the FishSET database and can be applied to any dataset using the <code>filter_dat</code> function. No function has been written to remove variables from the working data set. Users should use base R functions for this. Within the FishSET app variables can be removed from the working data set in the <code>Data Exploration</code> tab. Use the <code>add_vars</code> function to add variables from the raw data set back into the working data set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Filter</span>
  <span class="kw">filter_table</span>()
  <span class="kw">filter_dat</span>()

<span class="co">#Add variables back into the working data set</span>
  <span class="kw">add_vars</span>()</code></pre></div>
</div>
<div id="data-exploration" class="section level2">
<h2>Data Exploration</h2>
<p>View the spatial (<code>map_plot</code>) and temporal (<code>temp_plot</code>) distribution of data and the relationship between variables (<code>xy_plot</code>). Plots and tables to the <code>output</code> folder. The <code>map_kernel</code>, <code>getis_ord_stats</code>, and <code>moran_stats</code> functions provide measures of clustering, or hot spot analysis. The <code>density_plot</code> creates a density or cumulative distribution function plot of the selected variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Map</span>
  <span class="kw">map_plot</span>()
<span class="co">#map kernel</span>
  <span class="kw">map_kernel</span>()
<span class="co">#Getis Ord</span>
  <span class="kw">getis_ord_stats</span>()
<span class="co">#Moran's I</span>
  <span class="kw">moran_stats</span>()
<span class="co">#Temporal Plots</span>
  <span class="kw">temp_plot</span>()
<span class="co">#x-y plots</span>
  <span class="kw">xy_plot</span>(dat, project, var1, var2, <span class="dt">regress =</span> <span class="ot">FALSE</span>) 
  <span class="kw">density_plot</span>()</code></pre></div>
</div>
<div id="fleet-analyses" class="section level2">
<h2>Fleet Analyses</h2>
<p>Fleet functions focus on functions that allow users to assign vessels to fleet and view fleet characteristics (vessel count) and fleet effort (trip length, weekly effort), and catch as a fleet (species catch, by catch, weekly catch). All functions return output as plots and/or tables that are output to the R console and saved to the <code>output</code> folder.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Define and store fleet expressions </span>
  <span class="kw">fleet_assign</span>(dat, project, <span class="dt">cond =</span> <span class="ot">NULL</span>, <span class="dt">fleet_val =</span> <span class="ot">NULL</span>, <span class="dt">table =</span> <span class="ot">NULL</span>, <span class="dt">save =</span> <span class="ot">TRUE</span>)
<span class="co">#Number of unique vessels by time period</span>
  <span class="kw">vessel_count</span>(dat, project, v, t, <span class="dt">period =</span> <span class="st">&quot;month&quot;</span>, <span class="dt">group =</span> <span class="ot">NULL</span>, 
                         <span class="dt">year =</span> <span class="ot">NULL</span>, <span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="dt">output =</span> <span class="kw">c</span>(<span class="st">&quot;table&quot;</span>, <span class="st">&quot;plot&quot;</span>))
<span class="co">#Total species catch by period</span>
  <span class="kw">species_catch</span>(dat, project, species, date, <span class="dt">period =</span> <span class="st">&quot;month_abv&quot;</span>, <span class="dt">fun =</span> <span class="st">&quot;sum&quot;</span>, <span class="dt">group =</span> <span class="ot">NULL</span>, <span class="dt">year =</span> <span class="ot">NULL</span>, 
                          <span class="dt">convert_to_tons =</span> <span class="ot">TRUE</span>, <span class="dt">value =</span> <span class="kw">c</span>(<span class="st">&quot;count&quot;</span>, <span class="st">&quot;percent&quot;</span>), 
                          <span class="dt">output =</span> <span class="kw">c</span>(<span class="st">&quot;table&quot;</span>, <span class="st">&quot;plot&quot;</span>), <span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="dt">format_tab =</span> <span class="kw">c</span>(<span class="st">&quot;wide&quot;</span>, <span class="st">&quot;long&quot;</span>))
<span class="co">#Compare bycatch to other species caught</span>
  <span class="kw">bycatch</span>(dat, project, cpue, <span class="dt">catch =</span> <span class="ot">NULL</span> , date, <span class="dt">names =</span> <span class="ot">NULL</span>, <span class="dt">group =</span> <span class="ot">NULL</span>, 
                    <span class="dt">year =</span> <span class="ot">NULL</span>, <span class="dt">period =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="kw">c</span>(<span class="st">&quot;count&quot;</span>, <span class="st">&quot;stc&quot;</span>), 
                    <span class="dt">output =</span> <span class="kw">c</span>(<span class="st">&quot;table&quot;</span>, <span class="st">&quot;plot&quot;</span>), <span class="dt">format_tab =</span> <span class="st">&quot;wide&quot;</span>)
<span class="co">#Aggregate species catch by unique vessel ID</span>
  <span class="kw">sum_catch</span>(<span class="st">&quot;MainDataTable&quot;</span>, <span class="st">&quot;myProject&quot;</span>, <span class="st">&quot;catch&quot;</span>, <span class="st">&quot;species == 'cod' &amp; catch &gt; .5&quot;</span>, <span class="dt">val =</span> <span class="st">&quot;per&quot;</span>, <span class="dt">out =</span> <span class="st">&quot;logical&quot;</span>)
<span class="co">#Catch total by week</span>
  <span class="kw">weekly_catch</span>(dat, project, species, date, <span class="dt">year =</span> <span class="ot">NULL</span>, <span class="dt">group =</span> <span class="ot">NULL</span>, <span class="dt">fun =</span> <span class="st">&quot;sum&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>,
                         <span class="dt">convert_to_tons =</span> <span class="ot">FALSE</span>, <span class="dt">value =</span><span class="st">&quot;percent&quot;</span>, <span class="dt">output =</span> <span class="kw">c</span>(<span class="st">&quot;plot&quot;</span>, <span class="st">&quot;table&quot;</span>))
<span class="co">#Average CPUE by week</span>
  <span class="kw">weekly_effort</span>(dat, project, cpue, date, <span class="dt">group =</span> <span class="ot">NULL</span>, <span class="dt">year =</span> <span class="ot">NULL</span>, <span class="dt">plot_type =</span> <span class="st">&quot;line_point&quot;</span>, 
                          <span class="dt">output =</span> <span class="kw">c</span>(<span class="st">&quot;plot&quot;</span>, <span class="st">&quot;table&quot;</span>), <span class="dt">format_tab =</span> <span class="st">&quot;wide&quot;</span>)
<span class="co">#Create a plot or table of vessel trip length</span>
  <span class="kw">trip_length</span>(dat, project, start, end, <span class="dt">units =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">catch =</span> <span class="ot">NULL</span>, 
                        <span class="dt">hauls =</span> <span class="ot">NULL</span>, <span class="dt">output =</span> <span class="kw">c</span>(<span class="st">&quot;table&quot;</span>, <span class="st">&quot;plot&quot;</span>), <span class="dt">haul_to_trip =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
<div id="simple-analyses" class="section level2">
<h2>Simple Analyses</h2>
<p>View and quantify relationship between variables. The correlation function, <code>corr_out</code> returns a plot and table of correlations values between all numberic variables supplied. The regression function, <code>xy_plot', returns a plot with fitted simple linear regression line and test statitistics whne regress is set to TRUE. When</code>regress` is set to FALSE, points are plotted without a best fit line.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#correlation</span>
  <span class="kw">corr_out</span>(dat, project, <span class="dt">variables=</span><span class="st">'all'</span>)
<span class="co">#regression</span>
  <span class="kw">xy_plot</span>(dat, project, var1, var2, <span class="dt">regress =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="compute-new-variables" class="section level2">
<h2>Compute New Variables</h2>
<p>Modify or create variables such as cpue and trip centroid. Functions focus on data transformations, generating ID variables (for haul or fishery season), computing simple arithmetic functions such as catch per unit effort or sum of hauls, generate dummy variablesm, create a variety of spatial variables such as distance between hauls or the latitude and longitude of the haul midpoint, and create trip level functions such collapsing haul to trip and identfiying trip centroid.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Data Transformations</span>
  ##Change time unit
  temporal_mod
  ##Coded variable based on quantiles
  <span class="kw">set_quants</span>()
<span class="co">#Nominal ID</span>
  <span class="co">#Haul or Trip ID</span>
  <span class="kw">ID_var</span>()
  <span class="co">#Fishery Seasonal Identifier</span>
  <span class="kw">create_seasonal_ID</span>()
<span class="co">#Arithmetic and temporal</span>
  <span class="co">#Numeric functions</span>
  <span class="kw">create_var_num</span>()
  <span class="co">#CPUE</span>
  <span class="kw">cpue</span>()
<span class="co">#Dummy</span>
  <span class="co">#From variable</span>
  <span class="kw">dummy_num</span>()
  <span class="kw">dummy_matrix</span>()
<span class="co">#spatial</span>
  <span class="co">#Distance between two points</span>
  <span class="kw">create_dist_between</span>()
  <span class="co">#Haul midpoint </span>
  <span class="kw">create_mid_haul</span>()
  <span class="co">#Duration of time</span>
  <span class="kw">create_duration</span>()
  <span class="co">#Zone when choice where to go next was made</span>
  <span class="kw">create_startingloc</span>()
<span class="co">#Trip-level Functions</span>
  <span class="co">#Collapse Haul to trip</span>
  <span class="kw">haul_to_trip</span>()
  <span class="co">#Trip distance</span>
  <span class="kw">create_trip_distance</span>()
  <span class="co">#Trip centroid</span>
  <span class="kw">create_trip_centroid</span>()</code></pre></div>
</div>
<div id="zonal-definition" class="section level2">
<h2>Zonal Definition</h2>
<p>Functions in this group require a spatial data frame defining fishing or regulatory zone. Both the <code>find_centroid</code> and <code>assignment_column</code> can be used on their own but are called as necessary in other function. The <code>find_centroid</code> function identifies the centroid of a zone and the <code>assignment_column</code> function assigns observations in the primary data set to zones. The <code>create_alternative_choice</code> function defines alternative fishing choices and is required.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">find_centroid</span>()
  <span class="kw">assignment_column</span>()
  <span class="kw">create_alternative_choice</span>()</code></pre></div>
</div>
<div id="expected-catchrevenue" class="section level2">
<h2>Expected Catch/Revenue</h2>
<p>Compute expected catch or expected revenue. The function creates the expected catch/revenue matrix based on user-provided parameters, and three default cases: Near-term: Movng window size of two days. In this case, vessels are grouped based on defineGroup parameter. Medium-term: Moving window size of seven days. In this case, there is no grouping and catch for entire fleet is used. Long-term: Moving window size of seven days from the previous year. In this case, there is no grouping and catch for entire fleet is used. Output is saved in the FishSET database and called in the <code>make_model_design</code> function.</p>
<p>The <code>sparstable</code> function provides a table of data sparsity by time periods. It should be used to assess the availability of data for defining the temporal moving window size in the <code>create_expectations</code> function. Sparse data is not suited for shorter moving window sizes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">sparsetable</span>()  
  <span class="kw">create_expectations</span>()</code></pre></div>
</div>
<div id="model-design-file-and-run" class="section level2">
<h2>Model design file and run</h2>
<p>The <code>make_model_design</code> function creates a list with data and parameters required to run the models, which are called in the <code>discretefish_subroutine</code> function. The <code>discretefish_subroutine</code> requires inputs of initial parameters, optimization options (maximum iterations, the relative tolerance of x, report frequency, and whether to report iterations), the optimization method chosen, which must be one of the base R <code>optim</code> options, and a name for the model to allow for easier tracking and comparison of models. The subroutine also requires <code>catch</code>, <code>choice</code>, and <code>distance</code> data, plus any other data <code>otherdat</code> needed to run the chosen likelihood, such as expected catches or harvester data. These data are defined in the <code>make_model_design</code> file. Expected catches is pulled by the <code>make_model_design</code> function from the saved table generated by the <code>create_expectations</code> function. <code>make_model_design</code> calls output from <code>create_alternative_choice</code> to generate distance data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make_model_design</span>()
<span class="kw">discretefish_subroutine</span>()</code></pre></div>
<div id="likelihood-functions" class="section level3">
<h3>Likelihood functions</h3>
<p>FishSET includes six functions. User-created functions can be saved and logged using the <code>log_func-model</code> function. <code>logit_c</code> Conditional logit likelihood <code>logit_avgcat</code> Average catch multinomial logit procedure <code>logit_correction</code> Full information model with Dahl's correction function <code>epm_normal</code> Expected profit model normal catch function <code>epm_lognormal</code> Expected profit model lognormal catch function <code>epm_weibull</code> Expected profit model Weibull catch function</p>
</div>
<div id="model-run-output" class="section level3">
<h3>Model run output</h3>
<p>The discretefish_subroutine function can take 30 or minutes to run. Model run status is returned to the R console. The subroutine function outputs model results in a list that can be summarized as:</p>
<pre><code>errorExplain: If it exists, a description of the model error.
OutLogit: A matrix of coefficients, standard errors, and t-statistics
optoutput: Optimization information (such as number of function iterations)
seoutmat2: Standard errors
MCM: Model comparison metrics (e.g. AIC, BIC)
H1: The inverse hessian</code></pre>
<p>The output can be viewed using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Display errorExplain output</span>
<span class="kw">globalcheck_view</span>(<span class="st">'pcodldglobalcheck20190604'</span>)
<span class="co">#Display all other model output.</span>
<span class="kw">model_out_view</span>(<span class="st">'pcodmodelout20190604'</span>)</code></pre></div>
</div>
<div id="selecting-models" class="section level3">
<h3>Selecting models</h3>
<p>Model comparison metrics are conveniently saved in a table in the FishSET database. To access the table use <code>model_fit</code> with the project name. Identifying the best model for future reference requires <code>select_model</code>. This function utilized R Shiny to open an interactive window where best models can be selected and saved. Model selection can also be accomplished from the discretefish_subroutine function by setting the <code>select.model</code> parameter to TRUE. When the parameter is set to TRUE, a interactive window opens after the model has compiled and output has saved.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model_fit</span>(<span class="st">'pollock'</span>)
<span class="kw">select_model</span>()</code></pre></div>
</div>
</div>
<div id="interactivity" class="section level2">
<h2>Interactivity</h2>
<p>R Shiny is used to provide interactive interfaces. All FishSET functions described here can be run through a user interface with <code>run_fishset_gui</code>. The user interace guides users through loading data to model evaluation. In addition, users can use the <code>select_vars</code> function to open an interactive interface for selecting a subset of variables to keep in the working data set and the <code>add_vars</code> function to interactively select vars to add back into the working data set from the raw dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">run_fishset_gui</span>()
<span class="kw">select_vars</span>()
<span class="kw">select_model</span>()
<span class="kw">add_vars</span>()</code></pre></div>
</div>
<div id="reproducibility" class="section level2">
<h2>Reproducibility</h2>
<p>FishSET was designed with the aim of reproducibility. All function calls are logged in a dated file. Log files are stored in the <code>Logs</code> folder. Each log call has a functionID and a list of parameters supplies (args). Some logged functions includs kwargs, optional arguments, an output, or a message. The message section is used to save text output from a function call that users may want to reference later, such as the number of number of rows with missing data.</p>
<p>For example, the function call</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter_table</span>(<span class="dt">dat =</span> <span class="st">'pcodmaindatatable'</span>, <span class="dt">project =</span> <span class="st">'pcod'</span>, <span class="dt">x =</span> <span class="st">'PERFORMANCE_Code'</span>, <span class="dt">exp =</span> <span class="st">'PERFORMANCE_Code==1'</span>)</code></pre></div>
<p>returns the following log entry:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> {
          <span class="st">&quot;functionID&quot;</span><span class="op">:</span><span class="st"> &quot;filter_table&quot;</span>,
          <span class="st">&quot;args&quot;</span><span class="op">:</span><span class="st"> </span>[
            <span class="st">&quot;pcodMainDataTable&quot;</span>,
            <span class="st">&quot;pcod&quot;</span>,
            <span class="st">&quot;PERFORMANCE_Code&quot;</span>,
            <span class="st">&quot;PERFORMANCE_Code==1&quot;</span>
          ],
          <span class="st">&quot;kwargs&quot;</span><span class="op">:</span><span class="st"> </span>[],
          <span class="st">&quot;output&quot;</span><span class="op">:</span><span class="st"> &quot;&quot;</span>,
          <span class="st">&quot;msg&quot;</span><span class="op">:</span><span class="st"> </span>[
            {
              <span class="st">&quot;dataframe&quot;</span><span class="op">:</span><span class="st"> &quot;pcodMainDataTable&quot;</span>,
              <span class="st">&quot;vector&quot;</span><span class="op">:</span><span class="st"> &quot;PERFORMANCE_Code&quot;</span>,
              <span class="st">&quot;FilterFunction&quot;</span><span class="op">:</span><span class="st"> &quot;PERFORMANCE_Code==1&quot;</span>
            }
          ]
        }</code></pre></div>
<p>Log entries are written in JSON. Future version of FishSET will include a function that will read the log files and rerun function calls with current or updated data.</p>
<p>Logging is built into FishSET functions. However, it is possible to start a new log file using <code>log_reset</code>. New log files are started each day. User-created functions, such as likelihoods, can be saved for future use and logged using <code>log_func_model</code>.</p>
<div id="logging" class="section level3">
<h3>Logging</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">`</span><span class="dt">log_reset</span><span class="st">`</span>
<span class="st">`</span><span class="dt">log_func_model</span><span class="st">`</span></code></pre></div>
<p>In the FishSET app, each tab has a <code>Notes</code> sections that is saved to the <code>Output</code> folder. Comments, observations, or thoughts typed by the user in this section are saved in dated text files. Additional pre-build messages are also saved, such as output from data evaluation functions.</p>
<p>Finally, the FishSET package includes a Notebook template for report writing.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
